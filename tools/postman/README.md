# CMS eAPD Postman Scripts

This folder contains scripts that can be used to communicate with the eAPD api endpoint. The scripts are for use with [Postman](https://www.postman.com/) and were generated with version 7.28.0. The main script export file is hitech-apd.postman_collection.json. There are also 3 environment export files, which contain variables for the production, staging, and local dev environments. The variables are baseURL (used in every command), created-api-id (used in the "Patch new APD with sample data" commands), auth-username (used in "Get nonce"), auth-password (used in JSON). The files can be imported into Postman using the [instructions on the Postman website](https://learning.postman.com/docs/getting-started/importing-and-exporting-data/). You'll then need to replace the values in the variable settings (eg, username and password) with the values you want to use.

The scripts can be used to read and write APD data, as well as user, role, activity, and file information. First confirm that you are pointed to the correct environment. Then set the username and password variables and log in using a combination of the "Get Nonce" and "JSON" (/auth/login) commands. The first gets a nonce that allows you to login if passed to the second endpoint (the JSON command) within 3 seconds. So you have to move quickly! Once logged in you can use the other commands (they won't work until you're logged in).

One thing that might end up being common is to copy an APD from one environment to another, or to duplicate an APD in the same environment. In order to do that you would first use "Get list of user's APDs" and determine the id of the desired APD, then use "Get single ApD" (replacing the id number in the URL with the id of interest) to get the APD. Then you'll need to convert the body of the APD response into a write command. In /tools/postman folder is a file called "empty apd write command.json". Use that as a starting point and paste the parts of your recent APD response into it. Then do a "create new apd" and find the ID of the new one (with "Get list of user's APDs"). Finally, build a "Patch new APD with sample data" command with the correct ID in the URL and with the write command pasted into the body (remove the one that's there in the body first).
